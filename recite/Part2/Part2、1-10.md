1、多级缓存架构？








    客户端缓存（静态资源）：
            在浏览器层面主要缓存css，js，字体等静态资源文件
            例如：百度的图标，服务器在响应头中设置expires，浏览器在该段时间将图片以文件缓存在本地，客户端再次访问会看到
                from disk cache的提示，浏览器不再请求服务器，而是直接在本地取图片。
            可以很大程度上缓解浏览器重复请求静态资源的带宽损耗，客户端只需要缓存文件就可以。
    应用层缓存（静态资源）：
            CDN内容分发网络，是互联网静态资源分发的主要技术手段，是广域的互联网应用的基础设施，有效解决了带宽集中占用、资源分发的问题。
            CDN的核心技术是智能DNS。








            例如：大量上海用户访问北京资源。
            但是投入较高，可以租用阿里云、腾讯云、华为云提供的CDN服务，进行租用。
    
            对于企业级应用，工作人员往往分布在指定的工作区域，或相对固定的场所，再加上并发度并不是很高，
                也就没必要去部署CDN这样重量级的解决方案，可以在架构部署Nginx，利用其自带的静态资源缓存的能力和压缩的功能，
                就可以胜任绝大多数企业级应用场景。Nigix实际是在本地通过一个个目录的方式组织。
    
    服务层缓存（缓存后端接口查出的数据）：
            进程内缓存：应用中开辟内存空间，进程在运行中载入这块内存，通过本地内存的低延迟，高吞吐特性来提高程序的访问速度（ehCache）
            进程外缓存：分布式缓存（redis），集中缓存。
    
            先进到远、由快到慢的访问缓存。网络是不确定的，同时访问也是有上限的，所以不能上来就找Redis。
            要在应用端要设计多级应用缓存，通过进程内缓存和进程外缓存结合分摊压力。先看进程内缓存，再看进程外缓存，都查不到再去db，然后写回缓存。
    
            因为引入多级缓存，要考虑分布式缓存数据一致性问题，此时可以通过MQ主动推送给别的服务实例变更的数据。各实例收到后先删除本地缓存，再重新创建，以保存各实例的数据一致。

2、何时采用多级缓存架构？









3、MySqL集群模式与应用场景
    单库模式：










    读写分离模式：








    分库分表（分片）模式：








        分片算法：
        








    互联网主流MYsql集群架构：







4、为什么要垂直分表？何时进行垂直分表？
    innodb在1.0以后引入了压缩页，在跨页上解压缩和压缩的执行效率不高，所以表在设计的时候，要尽可能保证每一页内尽可能的多存储一些行数据。
    通过将重要字段剥离，让一页能容纳更多的行，进而缩小数据扫描的页范围，减少跨页检索，检索效率变高。

    数据总量很大且字段超过20，且包含了超长的varchar，CLOB，BLOB。
    
    主表中主要存放：查询（skuid，商户id）、排序时需要的字段（品牌编号）、高频访问的小字段（商品名称、价格）。
    从表中需要存放：低频访问字段、大字段（图文详情、图片BLOB）

5、为什么在大表严禁使用自增主键？
    在分布式下有严重的问题。
    1、每个分片能承载多少数据，只能靠猜，可能会产生比较大的浪费，不能在运行期间动态扩展的
    2、因为自增主键是在数据库层面生成自增的序列，那么数据库集群必须按主键范围分片（不能hash分片）
    3、范围分片会导致“尾部热点”效应。所有的操作都在一个热点分片上集中处理，该分片的数据库压力会非常大，而其他分片的数据库却没什么压力。

6、为什么不能使用uuid作为主键？
    1、128位，比起整形、长整形浪费空间。
    2、因为无序，作为主键会产生大量的索引重排（可见part1 -51）

7、简介雪花算法SnowFlake？
    有序，且每个机器上序列唯一。








    但是雪花算法要注意时间回拨的问题。但是平常基本不会去时间回拨。
8、布隆过滤器原理？
    二进制数组+n个hash函数。
    在数组中通过hash函数将有效数据所映射的n个位置为1。

    检验数据时，如果全部为1，则代表可能含有该数据。如果出现0，则代表肯定不含此数据。使用的时候只需maven引入redission，其中集成了bloomFilter。
    
    问题：商品删除了该怎么办？
        布隆过滤器因为某一位二进制可能被多个编号hash映射，因此布隆过滤器无法直接处理删除数据的情况。
        方案1、定时异步重建布隆过滤器（例如每4小时）
        方案2、计数bloomFilter

9、阿里开发规范解读：为啥禁用外键约束？
    表的外键是另一表的主键
    1、额外的数据一致性校验查询，会去另一张表查是否唯一等。
    2、并发问题：外键约束会在主表启用行级锁（共享锁），主表写入或者更新时（开启独占锁），若独占锁一直不释放，详情表会一直阻塞状态。从外界来看，
        所有详情表的写操作，都会因为主表的锁定进入阻塞，可能会导致大量的线程积压，甚至造成系统延迟，崩溃。
    3、级联删除：多层级联删除会让数据变的不可控。禁用是为了数据健壮和可追溯。
    4、数据耦合：数据库层面数据关系产生耦合，数据迁移维护困难，例如：数据多了，将数据源迁移，迁移至大数据库HBASE上，主外键无意义，需要去掉，那么以前程序里未校验的代码可能就出现问题。

10、为什么开发要禁用数据库IP直连？
    会造成两个模块之间强耦合。更换IP时费劲。
    解决：
        1、引入内部DNS：







        2、注册中心：

​        

​        
​        
​        